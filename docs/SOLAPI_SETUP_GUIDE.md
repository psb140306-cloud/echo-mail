# SOLAPI 설정 가이드

Echo Mail에서 SMS 및 카카오톡 메시지를 발송하기 위한 SOLAPI 설정 가이드입니다.

## 📋 목차

1. [SOLAPI 회원가입](#1-solapi-회원가입)
2. [API 키 발급](#2-api-키-발급)
3. [발신번호 등록](#3-발신번호-등록)
4. [카카오 비즈니스 채널 연동](#4-카카오-비즈니스-채널-연동)
5. [알림톡 템플릿 등록](#5-알림톡-템플릿-등록)
6. [환경변수 설정](#6-환경변수-설정)
7. [테스트](#7-테스트)

---

## 1. SOLAPI 회원가입

### 회원가입 절차

1. **SOLAPI 웹사이트 접속**
   - URL: https://solapi.com
   - 우측 상단 "회원가입" 클릭

2. **회원 정보 입력**
   - 이메일 주소
   - 비밀번호
   - 회사명
   - 사업자등록번호

3. **이메일 인증**
   - 가입 시 입력한 이메일로 인증 메일 발송
   - 인증 링크 클릭

4. **사업자 정보 등록**
   - 로그인 후 대시보드 접속
   - 좌측 메뉴 "설정" > "사업자 정보"
   - 사업자등록증 첨부

⏱️ **소요 시간**: 약 5-10분

---

## 2. API 키 발급

### API 키 생성 절차

1. **SOLAPI 대시보드 로그인**
   - https://solapi.dev/login

2. **API 키 생성**
   - 좌측 메뉴 "API Keys" 클릭
   - "새 API Key 만들기" 버튼 클릭
   - API Key 이름 입력 (예: "Echo Mail Production")
   - 생성 버튼 클릭

3. **API Key 및 API Secret 복사**
   ```
   API Key: NCXXXXXXXXXXXXXXXXXXXXXXXX
   API Secret: XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
   ```
   ⚠️ **중요**: API Secret는 생성 시 한 번만 표시됩니다. 안전한 곳에 보관하세요!

4. **환경변수에 저장**
   ```bash
   SOLAPI_API_KEY=your_api_key
   SOLAPI_API_SECRET=your_api_secret
   ```

⏱️ **소요 시간**: 약 2분

---

## 3. 발신번호 등록

### 발신번호 등록 절차

발신번호는 SMS를 발송할 때 수신자에게 표시되는 번호입니다.

#### 3.1 통신서비스 이용증명원 발급

1. **통신사 고객센터 방문 또는 전화**
   - SKT: 114
   - KT: 100
   - LG U+: 101

2. **통신서비스 이용증명원 신청**
   - "통신서비스 이용증명원 발급해주세요" 요청
   - 사업자용으로 신청
   - 팩스 또는 이메일로 수신

3. **서류 준비**
   - 통신서비스 이용증명원
   - 사업자등록증 사본

⏱️ **소요 시간**: 1-2시간 (통신사마다 다름)

#### 3.2 SOLAPI에 발신번호 등록

1. **SOLAPI 대시보드 접속**
   - 좌측 메뉴 "발신번호 관리" 클릭

2. **발신번호 등록**
   - "발신번호 등록" 버튼 클릭
   - 전화번호 입력 (예: 02-1234-5678 또는 010-1234-5678)
   - 회사명 또는 서비스명 입력
   - 통신서비스 이용증명원 첨부
   - 사업자등록증 첨부

3. **승인 대기**
   - SOLAPI 승인팀 검토
   - ⏱️ 승인 시간: **1-2 영업일**

4. **승인 완료 확인**
   - 이메일로 승인 완료 알림 수신
   - 대시보드에서 "승인됨" 상태 확인

⏱️ **총 소요 시간**: 1-2 영업일

---

## 4. 카카오 비즈니스 채널 연동

### 4.1 카카오 비즈니스 채널 개설

1. **카카오톡 채널 관리자센터 접속**
   - URL: https://center-pf.kakao.com/
   - 카카오 계정으로 로그인

2. **새 채널 만들기**
   - "새 채널 만들기" 버튼 클릭
   - 채널 이름: Echo Mail (또는 회사명)
   - 검색용 아이디: @echomail
   - 카테고리 선택

3. **비즈니스 채널 신청**
   - 좌측 메뉴 "관리" > "비즈니스 채널 신청"
   - 사업자 정보 입력
   - 사업자등록증 첨부
   - 신청 버튼 클릭

4. **승인 대기**
   - 카카오 심사팀 검토
   - ⏱️ 승인 시간: **2주 이상** (2025년 기준)

⏱️ **총 소요 시간**: 2-3주

### 4.2 고객센터 정보 등록 (필수 - 2025년 6월부터)

1. **카카오톡 채널 관리자센터 접속**

2. **고객센터 정보 입력**
   - 좌측 메뉴 "프로필" > "홈 탭 카드 설정" > "기본정보"
   - 고객센터 전화번호 입력
   - 고객센터 운영시간 입력
   - 저장

### 4.3 SOLAPI에 채널 연동

1. **SOLAPI 대시보드 접속**
   - 좌측 메뉴 "카카오톡" > "발신 프로필 관리"

2. **카카오 채널 연동**
   - "카카오톡 채널 연동" 버튼 클릭
   - 카카오톡 채널 관리자센터 로그인
   - 연동 승인

3. **발신 프로필 ID(pfId) 확인**
   - 연동 완료 후 pfId 자동 생성
   - pfId 복사 (예: `pfxxxxxxxxxxxxxxx`)

4. **환경변수에 저장**
   ```bash
   SOLAPI_KAKAO_PFID=your_pf_id
   ```

⏱️ **소요 시간**: 약 5분

---

## 5. 알림톡 템플릿 등록

### 템플릿 등록 절차

알림톡은 사전에 승인된 템플릿만 발송할 수 있습니다.

#### 5.1 SOLAPI에서 템플릿 등록

1. **SOLAPI 대시보드 접속**
   - 좌측 메뉴 "카카오톡" > "템플릿 관리"

2. **새 템플릿 등록**
   - "템플릿 등록" 버튼 클릭
   - 발신 프로필 선택
   - 템플릿 코드 입력 (예: `ORDER_RECEIVED`)
   - 템플릿 이름 입력 (예: `발주 접수 알림`)
   - 카테고리 선택: "배송/물류" 등

3. **템플릿 내용 작성**
   ```
   안녕하세요, #{고객명}님.

   발주가 접수되었습니다.
   예상 납품일: #{납품일} #{납품시간}

   감사합니다.
   ```

4. **변수 설정**
   - `#{고객명}`: 문자열
   - `#{납품일}`: 문자열
   - `#{납품시간}`: 문자열

5. **버튼 추가 (선택)**
   - 버튼명: "주문 내역 확인"
   - 버튼 타입: 웹 링크
   - URL: https://echomail.example.com/orders

6. **심사 요청**
   - "심사 요청" 버튼 클릭
   - ⏱️ 승인 시간: **영업일 기준 1-3일**

#### 5.2 템플릿 심사 기준

✅ **승인 가능한 내용**
- 주문/배송 정보
- 예약 확인
- 결제 완료
- 회원 가입 인증

❌ **승인 불가능한 내용**
- 광고성 문구
- 할인/이벤트 정보
- 외부 링크 (승인된 도메인 제외)
- 선정적/불법적 내용

⏱️ **총 소요 시간**: 1-3 영업일

---

## 6. 환경변수 설정

### .env 파일 설정

프로젝트 루트의 `.env.local` 파일에 다음 환경변수를 추가하세요:

```bash
# SOLAPI 기본 설정
SMS_PROVIDER=solapi
KAKAO_PROVIDER=solapi

# SOLAPI API 인증
SOLAPI_API_KEY=your_api_key_here
SOLAPI_API_SECRET=your_api_secret_here

# SMS 발신번호
SOLAPI_SENDER_PHONE=02-1234-5678

# 카카오톡 발신 프로필
SOLAPI_KAKAO_PFID=your_pf_id_here

# 운영 환경에서만 실제 발송
ENABLE_REAL_NOTIFICATIONS=false  # 개발: false, 운영: true
NODE_ENV=development             # 개발: development, 운영: production
```

### Vercel 환경변수 설정

1. **Vercel 대시보드 접속**
   - https://vercel.com/dashboard
   - 프로젝트 선택

2. **환경변수 추가**
   - Settings > Environment Variables
   - 위의 환경변수 모두 추가
   - Production, Preview, Development 모두 선택

3. **재배포**
   - Deployments 탭
   - 최신 배포 우측 "⋯" 클릭
   - "Redeploy" 선택

---

## 7. 테스트

### 7.1 개발 환경 테스트 (테스트 모드)

```bash
# 환경변수 설정
ENABLE_REAL_NOTIFICATIONS=false
NODE_ENV=development

# 서버 실행
npm run dev
```

테스트 모드에서는:
- ✅ 실제 SMS/카카오톡이 발송되지 않음
- ✅ 로그에만 기록됨
- ✅ 비용 발생 없음

### 7.2 API 테스트

알림 테스트 페이지에 접속하여 테스트:

```
http://localhost:3000/notifications/test
```

또는 API 직접 호출:

```bash
curl -X POST http://localhost:3000/api/notifications/send \
  -H "Content-Type: application/json" \
  -d '{
    "type": "SMS",
    "recipient": "010-1234-5678",
    "templateName": "ORDER_RECEIVED_SMS",
    "variables": {
      "고객명": "홍길동",
      "납품일": "2025년 1월 15일 (수)",
      "납품시간": "오전"
    }
  }'
```

### 7.3 운영 환경 테스트 (실제 발송)

⚠️ **주의**: 실제 비용이 발생합니다!

```bash
# 환경변수 설정
ENABLE_REAL_NOTIFICATIONS=true
NODE_ENV=production
```

1. **소액 충전**
   - SOLAPI 대시보드 > 충전
   - 1만원 정도 충전 (테스트용)

2. **본인 번호로 테스트**
   - 본인 휴대폰 번호로 먼저 테스트
   - SMS/알림톡 정상 수신 확인

3. **로그 확인**
   - Vercel 로그 확인
   - SOLAPI 대시보드에서 발송 내역 확인

---

## 📊 요약: 전체 소요 시간

| 단계 | 소요 시간 | 비고 |
|------|----------|------|
| 1. 회원가입 | 5-10분 | 즉시 |
| 2. API 키 발급 | 2분 | 즉시 |
| 3. 발신번호 등록 | 1-2 영업일 | 통신사 서류 필요 |
| 4. 카카오 채널 연동 | 2-3주 | 카카오 심사 필요 |
| 5. 알림톡 템플릿 등록 | 1-3 영업일 | 템플릿별 개별 심사 |

**SMS만 사용**: 약 **2-3일**
**카카오톡 포함**: 약 **3-4주**

---

## 💰 비용

### SOLAPI 요금제 (2025년 기준)

| 서비스 | 단가 | 비고 |
|--------|------|------|
| SMS (단문) | 15원 | 90자 이하 |
| LMS (장문) | 45원 | 2,000자 이하 |
| MMS (그림문자) | 150원 | 이미지 포함 |
| 알림톡 | 9원 | 템플릿 기반 |
| 친구톡 | 15원 | 광고성 |

- **충전 방식**: 선불 충전 (최소 10,000원)
- **월 정액제**: 없음 (사용한 만큼만 과금)
- **API 사용료**: 무료

---

## 🆘 문제 해결

### Q1. API Key가 작동하지 않아요
- API Secret을 정확히 복사했는지 확인
- 환경변수 이름이 정확한지 확인 (`SOLAPI_API_KEY`, `SOLAPI_API_SECRET`)
- SOLAPI 대시보드에서 API Key 상태 확인

### Q2. 발신번호 등록이 승인되지 않아요
- 통신서비스 이용증명원이 최신인지 확인 (6개월 이내)
- 사업자등록증과 통신서비스 이용증명원의 회사명이 일치하는지 확인
- SOLAPI 고객센터 문의: 1577-****

### Q3. 카카오 채널 승인이 오래 걸려요
- 정상입니다. 카카오 비즈니스 채널 승인은 보통 2-3주 소요됩니다.
- 카카오톡 채널 관리자센터에서 심사 상태 확인 가능

### Q4. 알림톡 템플릿이 반려되었어요
- 반려 사유 확인 (SOLAPI 대시보드 > 템플릿 관리)
- 광고성 문구 제거
- 정보성 내용만 포함
- 재심사 요청

### Q5. 테스트 모드가 작동하지 않아요
- `ENABLE_REAL_NOTIFICATIONS=false` 확인
- `NODE_ENV=development` 확인
- 서버 재시작

---

## 📞 고객 지원

### SOLAPI 고객센터
- 📧 이메일: support@solapi.com
- 📞 전화: 1577-****
- 💬 실시간 채팅: https://solapi.com (우측 하단)
- 📚 문서: https://docs.solapi.com

### Echo Mail 팀
- 내부 문의 채널 활용

---

## ✅ 체크리스트

설정 완료 전 반드시 확인하세요:

- [ ] SOLAPI 회원가입 및 사업자 정보 등록
- [ ] API Key 발급 및 환경변수 설정
- [ ] 발신번호 등록 및 승인 완료
- [ ] 카카오 비즈니스 채널 개설 및 연동
- [ ] 고객센터 정보 등록 (2025년 6월부터 필수)
- [ ] 알림톡 템플릿 등록 및 승인
- [ ] 환경변수 `.env.local` 설정
- [ ] Vercel 환경변수 설정
- [ ] 테스트 모드로 테스트 완료
- [ ] 소액 충전 후 실제 발송 테스트

---

**작성일**: 2025년 10월 23일
**최종 수정일**: 2025년 10월 23일
**작성자**: Claude (Echo Mail Development Team)
