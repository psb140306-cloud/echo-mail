#!/bin/bash

# =============================================================================
# Echo Mail Vercel λ°°ν¬ μ¤ν¬λ¦½νΈ
# =============================================================================

set -e

echo "π€ Echo Mail Vercel λ°°ν¬λ¥Ό μ‹μ‘ν•©λ‹λ‹¤..."

# ν™κ²½ λ³€μ ν™•μΈ
if [ ! -f .env.local ]; then
    echo "β .env.local νμΌμ΄ μ—†μµλ‹λ‹¤. ν™κ²½ λ³€μλ¥Ό μ„¤μ •ν•΄μ£Όμ„Έμ”."
    exit 1
fi

# λΉλ“ ν…μ¤νΈ
echo "π”¨ ν”„λ΅λ•μ… λΉλ“λ¥Ό ν…μ¤νΈν•©λ‹λ‹¤..."
npm run build

# νƒ€μ… μ²΄ν¬
echo "π” TypeScript νƒ€μ…μ„ μ²΄ν¬ν•©λ‹λ‹¤..."
npm run type-check

# λ¦°νΈ μ²΄ν¬
echo "π“ μ½”λ“ μ¤νƒ€μΌμ„ μ²΄ν¬ν•©λ‹λ‹¤..."
npm run lint

# Vercel λ°°ν¬
echo "π Vercelμ— λ°°ν¬ν•©λ‹λ‹¤..."
if [ "$1" = "prod" ] || [ "$1" = "production" ]; then
    vercel --prod
    echo "β… ν”„λ΅λ•μ… λ°°ν¬κ°€ μ™„λ£λμ—μµλ‹λ‹¤!"
else
    vercel
    echo "β… ν”„λ¦¬λ·° λ°°ν¬κ°€ μ™„λ£λμ—μµλ‹λ‹¤!"
fi
